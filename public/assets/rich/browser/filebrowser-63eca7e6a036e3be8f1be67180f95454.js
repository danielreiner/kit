// Rich filebrowser configuration, initialization and main controller
var rich=rich||{};rich.Browser=function(){this._options={currentStyle:"",insertionModeMany:!1,currentPage:1,loading:!1,reachedBottom:!1,viewModeGrid:!0}},rich.Browser.prototype={initialize:function(){this.initStyles($.QueryString.allowed_styles,$.QueryString.default_style),this._options.insertionModeMany=$.QueryString["insert_many"]=="true"?!0:!1,this.toggleInsertionMode(!1),this.toggleViewMode(!1)},initStyles:function(e,t){e=e.split(","),$.each(e,function(e,t){t!="rich_thumb"&&$("#styles").append("<li class='scope' id='style-"+t+"' data-rich-style='"+t+"'>"+t+"</li>")}),browser.selectStyle(t);var n=$.QueryString.dom_id,r=n?n.split("_"):null;if(e.length<2||r&&r[r.length-1]=="id")$("#styles").hide(),browser.selectStyle(e[0])},setLoading:function(e){this._options.loading=e,e==1?$("#loading").fadeIn():$("#loading").fadeOut()},selectStyle:function(e){this._options.currentStyle=e,$("#styles li").removeClass("selected"),$("#style-"+e).addClass("selected")},toggleInsertionMode:function(e){e==1&&(this._options.insertionModeMany=!this._options.insertionModeMany),this._options.insertionModeMany==1?($("#insert-one").hide(),$("#insert-many").show()):($("#insert-one").show(),$("#insert-many").hide())},toggleViewMode:function(e){e==1?this._options.viewModeGrid=!this._options.viewModeGrid:this._options.viewModeGrid=$.QueryString["viewMode"]=="grid"?!1:!0,this._options.viewModeGrid==1?($("#view-grid").hide(),$("#view-list").show(),$("#items").addClass("list")):($("#view-grid").show(),$("#view-list").hide(),$("#items").removeClass("list"))},selectItem:function(e){var t=$(e).data("uris")[this._options.currentStyle],n=$(e).data("rich-asset-id"),r=$(e).data("rich-asset-type"),i=$(e).data("rich-asset-name");$.QueryString["CKEditor"]=="picker"?window.opener.assetPicker.setAsset($.QueryString.dom_id,t,n,r):window.opener.CKEDITOR.tools.callFunction($.QueryString.CKEditorFuncNum,t,n,i);var s=this;window.setTimeout(function(){s._options.insertionModeMany==0?window.close():window.focus()},100)},loadNextPage:function(){if(this._options.loading||this._options.reachedBottom)return;if(this.nearBottomOfWindow()){this.setLoading(!0),this._options.currentPage++;var e=this;$.ajax({url:window.location.href+"&page="+this._options.currentPage,type:"get",dataType:"script",success:function(t){t==""&&(e._options.reachedBottom=!0),e.setLoading(!1)}})}},nearBottomOfWindow:function(){return $(window).scrollTop()>$(document).height()-$(window).height()-100}};var browser;$(function(){browser=new rich.Browser,browser.initialize(),new rich.Uploader,$("#insert-one, #insert-many").click(function(e){return browser.toggleInsertionMode(!0),e.preventDefault(),!1}),$("#view-grid, #view-list").click(function(e){return browser.toggleViewMode(!0),e.preventDefault(),!1}),$("#styles li").click(function(e){browser.selectStyle($(this).data("rich-style"))}),$("body").on("click","#items li img",function(e){browser.selectItem(e.target)}),$(window).scroll(function(){browser.loadNextPage()})});