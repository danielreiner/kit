/**
 * @license Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.html or http://ckeditor.com/license
 */
/**
 * @fileOverview AutoGrow plugin.
 */
(function(){function e(e){var t=e.getStyle("overflow-y"),n=e.getDocument(),r=CKEDITOR.dom.element.createFromHtml('<span style="margin:0;padding:0;border:0;clear:both;width:1px;height:1px;display:block;">'+(CKEDITOR.env.webkit?"&nbsp;":"")+"</span>",n);n[CKEDITOR.env.ie?"getBody":"getDocumentElement"]().append(r);var i=r.getDocumentPosition(n).y+r.$.offsetHeight;return r.remove(),e.setStyle("overflow-y",t),i}function t(e){var t=e.document,n=t.getBody(),r=t.getDocumentElement();return t.$.compatMode=="BackCompat"?n:r}var n=function(n){if(!n.window)return;var r=n.getCommand("maximize");if(r&&r.state==CKEDITOR.TRISTATE_ON)return;var i=t(n),s=n.window.getViewPaneSize().height,o=e(i);o+=n.config.autoGrow_bottomSpace||0;var u=n.config.autoGrow_minHeight!=undefined?n.config.autoGrow_minHeight:200,a=n.config.autoGrow_maxHeight||Infinity;o=Math.max(o,u),o=Math.min(o,a),o!=s&&(o=n.fire("autoGrow",{currentHeight:s,newHeight:o}).newHeight,n.resize(n.container.getStyle("width"),o,!0)),i.$.scrollHeight>i.$.clientHeight&&o<a?i.setStyle("overflow-y","hidden"):i.removeStyle("overflow-y")};CKEDITOR.plugins.add("autogrow",{init:function(e){if(e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE)return;e.on("instanceReady",function(){var r=e.editable();if(r.isInline())e.ui.space("contents").setStyle("height","auto");else{e.addCommand("autogrow",{exec:n,modes:{wysiwyg:1},readOnly:1,canUndo:!1,editorFocus:!1});var i={contentDom:1,key:1,selectionChange:1,insertElement:1,mode:1};for(var s in i)e.on(s,function(e){e.editor.mode=="wysiwyg"&&setTimeout(function(){n(e.editor),n(e.editor)},100)});e.on("afterCommandExec",function(r){if(r.data.name=="maximize"&&r.editor.mode=="wysiwyg")if(r.data.command.state==CKEDITOR.TRISTATE_ON){var i=t(e);i.removeStyle("overflow")}else n(e)}),e.config.autoGrow_onStartup&&e.execCommand("autogrow")}})}})})();