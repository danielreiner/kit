/**
 * @license Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.html or http://ckeditor.com/license
 */
(function(){function e(e){if(!e||e.type!=CKEDITOR.NODE_ELEMENT||e.getName()!="form")return[];var t=[],n=["style","className"];for(var r=0;r<n.length;r++){var i=n[r],s=e.$.elements.namedItem(i);if(s){var o=new CKEDITOR.dom.element(s);t.push([o,o.nextSibling]),o.remove()}}return t}function t(e,t){if(!e||e.type!=CKEDITOR.NODE_ELEMENT||e.getName()!="form")return;if(t.length>0)for(var n=t.length-1;n>=0;n--){var r=t[n][0],i=t[n][1];i?r.insertBefore(i):r.appendTo(e)}}function n(n,r){var i=e(n),s={},o=n.$;return r||(s["class"]=o.className||"",o.className=""),s.inline=o.style.cssText||"",r||(o.style.cssText="position: static; overflow: visible"),t(i),s}function r(n,r){var i=e(n),s=n.$;"class"in r&&(s.className=r["class"]),"inline"in r&&(s.style.cssText=r.inline),t(i)}function i(e){var t=CKEDITOR.instances;for(var n in t){var r=t[n];if(r.mode=="wysiwyg"&&!r.readOnly){var i=r.document.getBody();i.setAttribute("contentEditable",!1),i.setAttribute("contentEditable",!0)}}e.editable().hasFocus&&(e.toolbox.focus(),e.focus())}CKEDITOR.plugins.add("maximize",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en-au,en-ca,en-gb,en,eo,es,et,eu,fa,fi,fo,fr-ca,fr,gl,gu,he,hi,hr,hu,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt-br,pt,ro,ru,sk,sl,sr-latn,sr,sv,th,tr,ug,uk,vi,zh-cn,zh",icons:"maximize",init:function(e){function l(){var t=o.getViewPaneSize();e.resize(t.width,t.height,null,!0)}if(e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE)return;var t=e.lang,s=CKEDITOR.document,o=s.getWindow(),u,a,f,c=CKEDITOR.TRISTATE_OFF;e.addCommand("maximize",{modes:{wysiwyg:!CKEDITOR.env.iOS,source:!CKEDITOR.env.iOS},readOnly:1,editorFocus:!1,exec:function(){var h=e.container.getChild(1),p=e.ui.space("contents");if(e.mode=="wysiwyg"){var d=e.getSelection();u=d&&d.getRanges(),a=o.getScrollPosition()}else{var v=e.editable().$;u=!CKEDITOR.env.ie&&[v.selectionStart,v.selectionEnd],a=[v.scrollLeft,v.scrollTop]}if(this.state==CKEDITOR.TRISTATE_OFF){o.on("resize",l),f=o.getScrollPosition();var m=e.container;while(m=m.getParent())m.setCustomData("maximize_saved_styles",n(m)),m.setStyle("z-index",e.config.baseFloatZIndex-5);p.setCustomData("maximize_saved_styles",n(p,!0)),h.setCustomData("maximize_saved_styles",n(h,!0));var g={overflow:CKEDITOR.env.webkit?"":"hidden",width:0,height:0};s.getDocumentElement().setStyles(g),!CKEDITOR.env.gecko&&s.getDocumentElement().setStyle("position","fixed"),(!CKEDITOR.env.gecko||!CKEDITOR.env.quirks)&&s.getBody().setStyles(g),CKEDITOR.env.ie?setTimeout(function(){o.$.scrollTo(0,0)},0):o.$.scrollTo(0,0),h.setStyle("position",CKEDITOR.env.gecko&&CKEDITOR.env.quirks?"fixed":"absolute"),h.$.offsetLeft,h.setStyles({"z-index":e.config.baseFloatZIndex-5,left:"0px",top:"0px"}),h.addClass("cke_maximized"),l();var y=h.getDocumentPosition();h.setStyles({left:-1*y.x+"px",top:-1*y.y+"px"}),CKEDITOR.env.gecko&&i(e)}else if(this.state==CKEDITOR.TRISTATE_ON){o.removeListener("resize",l);var b=[p,h];for(var w=0;w<b.length;w++)r(b[w],b[w].getCustomData("maximize_saved_styles")),b[w].removeCustomData("maximize_saved_styles");m=e.container;while(m=m.getParent())r(m,m.getCustomData("maximize_saved_styles")),m.removeCustomData("maximize_saved_styles");CKEDITOR.env.ie?setTimeout(function(){o.$.scrollTo(f.x,f.y)},0):o.$.scrollTo(f.x,f.y),h.removeClass("cke_maximized"),CKEDITOR.env.webkit&&(h.setStyle("display","inline"),setTimeout(function(){h.setStyle("display","block")},0)),e.fire("resize")}this.toggleState();var E=this.uiItems[0];if(E){var S=this.state==CKEDITOR.TRISTATE_OFF?t.maximize.maximize:t.maximize.minimize,x=CKEDITOR.document.getById(E._.id);x.getChild(1).setHtml(S),x.setAttribute("title",S),x.setAttribute("href",'javascript:void("'+S+'");')}if(e.mode=="wysiwyg")if(u){CKEDITOR.env.gecko&&i(e),e.getSelection().selectRanges(u);var T=e.getSelection().getStartElement();T&&T.scrollIntoView(!0)}else o.$.scrollTo(a.x,a.y);else u&&(v.selectionStart=u[0],v.selectionEnd=u[1]),v.scrollLeft=a[0],v.scrollTop=a[1];u=a=null,c=this.state,e.fire("maximize",this.state)},canUndo:!1}),e.ui.addButton&&e.ui.addButton("Maximize",{label:t.maximize.maximize,command:"maximize",toolbar:"tools,10"}),e.on("mode",function(){var t=e.getCommand("maximize");t.setState(t.state==CKEDITOR.TRISTATE_DISABLED?CKEDITOR.TRISTATE_DISABLED:c)},null,null,100)}})})();