(function(){function e(e,t,n){var r;return r=e.getWrapperElement().appendChild(document.createElement("div")),r.className=n?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top",r.innerHTML=t,r}CodeMirror.defineExtension("openDialog",function(t,n,r){function i(){o||(o=!0,s.parentNode.removeChild(s))}var s=e(this,t,r&&r.bottom),o=!1,u=this,a=s.getElementsByTagName("input")[0];if(a)CodeMirror.on(a,"keydown",function(e){(13==e.keyCode||27==e.keyCode)&&(CodeMirror.e_stop(e),i(),u.focus(),13==e.keyCode&&n(a.value))}),r&&r.value&&(a.value=r.value),a.focus(),CodeMirror.on(a,"blur",i);else if(t=s.getElementsByTagName("button")[0])CodeMirror.on(t,"click",function(){i(),u.focus()}),t.focus(),CodeMirror.on(t,"blur",i);return i}),CodeMirror.defineExtension("openConfirm",function(t,n,r){function i(){o||(o=!0,s.parentNode.removeChild(s),u.focus())}var s=e(this,t,r&&r.bottom),t=s.getElementsByTagName("button"),o=!1,u=this,a=1,f;t[0].focus();for(r=0;r<t.length;++r)f=t[r],function(e){CodeMirror.on(f,"click",function(t){CodeMirror.e_preventDefault(t),i(),e&&e(u)})}(n[r]),CodeMirror.on(f,"blur",function(){--a,setTimeout(function(){0>=a&&i()},200)}),CodeMirror.on(f,"focus",function(){++a})})})(),function(){function e(e){return"string"==typeof e?{token:function(t){if(t.match(e))return"searching";t.next(),t.skipTo(e.charAt(0))||t.skipToEnd()}}:{token:function(t){if(t.match(e))return"searching";for(;!t.eol()&&(t.next(),!t.match(e,!1)););}}}function t(){this.overlay=this.posFrom=this.posTo=this.query=null}function n(e,t,n){return e.getSearchCursor(t,n,"string"==typeof t&&t==t.toLowerCase())}function r(e,t,n,r){e.openDialog?e.openDialog(t,r):r(prompt(n,""))}function i(e,t,n,r){e.openConfirm?e.openConfirm(t,r):confirm(n)&&r[0]()}function s(e){var t=e.match(/^\/(.*)\/([a-z]*)$/);return t?RegExp(t[1],-1==t[2].indexOf("i")?"":"i"):e}function o(n,i){var o=n._searchState||(n._searchState=new t);if(o.query)return u(n,i);r(n,l,"Search for:",function(t){n.operation(function(){t&&!o.query&&(o.query=s(t),n.removeOverlay(o.overlay),o.overlay=e(t),n.addOverlay(o.overlay),o.posFrom=o.posTo=n.getCursor(),u(n,i))})})}function u(e,r){e.operation(function(){var i=e._searchState||(e._searchState=new t),s=n(e,i.query,r?i.posFrom:i.posTo);(s.find(r)||(s=n(e,i.query,r?CodeMirror.Pos(e.lastLine()):CodeMirror.Pos(e.firstLine(),0)),s.find(r)))&&(e.setSelection(s.from(),s.to()),i.posFrom=s.from(),i.posTo=s.to())})}function a(e){e.operation(function(){var n=e._searchState||(e._searchState=new t);n.query&&(n.query=null,e.removeOverlay(n.overlay))})}function f(e,t){r(e,c,"Replace:",function(o){o&&(o=s(o),r(e,h,"Replace with:",function(r){if(t)e.operation(function(){for(var t,i=n(e,o);i.findNext();)"string"!=typeof o?(t=e.getRange(i.from(),i.to()).match(o),i.replace(r.replace(/\$(\d)/,function(e,n){return t[n]}))):i.replace(r)});else{a(e);var s=n(e,o,e.getCursor()),u=function(){var t=s.from(),r;((r=s.findNext())||(s=n(e,o),(r=s.findNext())&&(!t||s.from().line!=t.line||s.from().ch!=t.ch)))&&(e.setSelection(s.from(),s.to()),i(e,p,"Replace?",[function(){f(r)},u]))},f=function(e){s.replace("string"==typeof o?r:r.replace(/\$(\d)/,function(t,n){return e[n]})),u()};u()}}))})}var l='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',c='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',h='With: <input type="text" style="width: 10em"/>',p="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";CodeMirror.commands.find=function(e){a(e),o(e)},CodeMirror.commands.findNext=o,CodeMirror.commands.findPrev=function(e){o(e,!0)},CodeMirror.commands.clearSearch=a,CodeMirror.commands.replace=f,CodeMirror.commands.replaceAll=function(e){f(e,!0)}}(),function(){function e(e,n,r,i){if(this.atOccurrence=!1,this.cm=e,null==i&&"string"==typeof n&&(i=!1),r=r?e.clipPos(r):t(0,0),this.pos={from:r,to:r},"string"!=typeof n)n.global||(n=RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(r,i){var s;if(r){n.lastIndex=0;for(var o=e.getLine(i.line).slice(0,i.ch),u=n.exec(o),f=0;u;){if(f+=u.index+1,o=o.slice(f),n.lastIndex=0,s=n.exec(o),!s)break;u=s}f--}else n.lastIndex=i.ch,o=e.getLine(i.line),f=(u=n.exec(o))&&u.index;if(u&&u[0])return{from:t(i.line,f),to:t(i.line,f+u[0].length),match:u}};else{i&&(n=n.toLowerCase());var s=i?function(e){return e.toLowerCase()}:function(e){return e},o=n.split("\n");this.matches=1==o.length?n.length?function(r,i){var o=s(e.getLine(i.line)),u=n.length,f;if(r?i.ch>=u&&-1!=(f=o.lastIndexOf(n,i.ch-u)):-1!=(f=o.indexOf(n,i.ch)))return{from:t(i.line,f),to:t(i.line,f+u)}}:function(){}:function(n,r){var i=r.line,u=n?o.length-1:0,a=o[u],f=s(e.getLine(i)),l=n?f.indexOf(a)+a.length:f.lastIndexOf(a),c,h,p;if(!(n?l>=r.ch||l!=a.length:l<=r.ch||l!=f.length-a.length))for(;n?!!i:i!=e.lineCount()-1;){if(f=s(e.getLine(i+=n?-1:1)),a=o[n?--u:++u],!(0<u&&u<o.length-1))return(c=n?f.lastIndexOf(a):f.indexOf(a)+a.length,n?c!=f.length-a.length:c!=a.length)?void 0:(h=t(r.line,l),p=t(i,c),{from:n?p:h,to:n?h:p});if(f!=a)break}}}}var t=CodeMirror.Pos;e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function n(e){return e=t(e,0),r.pos={from:e,to:e},r.atOccurrence=!1,!1}for(var r=this,i=this.cm.clipPos(e?this.pos.from:this.pos.to),s;;){if(this.pos=this.matches(e,i))return this.pos.from&&this.pos.to||console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!i.line)return n(0);i=t(i.line-1,this.cm.getLine(i.line-1).length)}else{if(s=this.cm.lineCount(),i.line==s-1)return n(s);i=t(i.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e){this.atOccurrence&&(e=CodeMirror.splitLines(e),this.cm.replaceRange(e,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0)))}},CodeMirror.defineExtension("getSearchCursor",function(t,n,r){return new e(this,t,n,r)})}();