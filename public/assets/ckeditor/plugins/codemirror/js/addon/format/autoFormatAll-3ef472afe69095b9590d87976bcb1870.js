(function(){CodeMirror.defineExtension("autoFormatAll",function(e,t){for(var n=this,r=n.getMode(),i=n.getRange(e,t).split("\n"),s=CodeMirror.copyState(r,n.getTokenAt(e).state),o=n.getOption("tabSize"),u="",a=0,f=0==e.ch,l=0;l<i.length;++l){for(var c=new CodeMirror.StringStream(i[l],o);!c.eol();){var h=CodeMirror.innerMode(r,s),p=r.token(c,s),d=c.current();c.start=c.pos;if(!f||/\S/.test(d))u+=d,f=!1;!f&&h.mode.newlineAfterToken&&h.mode.newlineAfterToken(p,d,c.string.slice(c.pos)||i[l+1]||"",h.state)&&(u+="\n",f=!0,++a)}!c.pos&&r.blankLine&&r.blankLine(s),!f&&l<i.length-1&&(u+="\n",f=!0,++a)}n.operation(function(){n.replaceRange(u,e,t);for(var r=e.line+1,i=e.line+a;r<=i;++r)n.indentLine(r,"smart");n.setCursor({line:0,ch:0})})})})();