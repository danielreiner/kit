(function(){function e(e,n,r,s){this.atOccurrence=!1,this.cm=e,null==s&&"string"==typeof n&&(s=!1),r=r?e.clipPos(r):t(0,0),this.pos={from:r,to:r};if("string"!=typeof n)n.global||(n=RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(r,s){if(r){n.lastIndex=0;for(var o=e.getLine(s.line).slice(0,s.ch),u=n.exec(o),f=0;u;){f+=u.index+1,o=o.slice(f),n.lastIndex=0;var l=n.exec(o);if(!l)break;u=l}f--}else n.lastIndex=s.ch,o=e.getLine(s.line),f=(u=n.exec(o))&&u.index;if(u&&u[0])return{from:t(s.line,f),to:t(s.line,f+u[0].length),match:u}};else{s&&(n=n.toLowerCase());var o=s?function(e){return e.toLowerCase()}:function(e){return e},u=n.split("\n");this.matches=1==u.length?n.length?function(r,s){var u=o(e.getLine(s.line)),f=n.length,l;if(r?s.ch>=f&&-1!=(l=u.lastIndexOf(n,s.ch-f)):-1!=(l=u.indexOf(n,s.ch)))return{from:t(s.line,l),to:t(s.line,l+f)}}:function(){}:function(n,r){var s=r.line,a=n?u.length-1:0,f=u[a],l=o(e.getLine(s)),c=n?l.indexOf(f)+f.length:l.lastIndexOf(f);if(!(n?c>=r.ch||c!=f.length:c<=r.ch||c!=l.length-f.length))for(;n?!!s:s!=e.lineCount()-1;){l=o(e.getLine(s+=n?-1:1)),f=u[n?--a:++a];if(0<a&&a<u.length-1){if(l!=f)break;continue}a=n?l.lastIndexOf(f):l.indexOf(f)+f.length;if(n?a!=l.length-f.length:a!=f.length)break;return f=t(r.line,c),s=t(s,a),{from:n?s:f,to:n?f:s}}}}}var t=CodeMirror.Pos;e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function n(e){return e=t(e,0),r.pos={from:e,to:e},r.atOccurrence=!1}for(var r=this,s=this.cm.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,s))return(!this.pos.from||!this.pos.to)&&console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!s.line)return n(0);s=t(s.line-1,this.cm.getLine(s.line-1).length)}else{var o=this.cm.lineCount();if(s.line==o-1)return n(o);s=t(s.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e){this.atOccurrence&&(e=CodeMirror.splitLines(e),this.cm.replaceRange(e,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+e.length-1,e[e.length-1].length+(1==e.length?this.pos.from.ch:0)))}},CodeMirror.defineExtension("getSearchCursor",function(t,n,r){return new e(this,t,n,r)})})();